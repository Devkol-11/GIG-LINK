generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id String @id @default(uuid())

  email           String  @unique
  passwordHash    String
  firstName       String
  lastName        String
  phoneNumber     String
  isEmailVerified Boolean @default(false)
  role            ROLE    @default(FREELANCER)
  refreshToken    String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  profile           UserProfile?
  creatorProfile    Creator?
  freelancerProfile Freelancer?
  refreshTokens     RefreshToken[]
  otp               Otp[]
  settings          UserSettings?

  @@map("users")
}

enum ROLE {
  CREATOR
  FREELANCER
  ADMIN
}

model RefreshToken {
  id String @id @default(uuid())

  userId String
  token  String @unique

  expiresAt DateTime
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("refresh_tokens")
}

model UserProfile {
  id     String @id @default(uuid())
  userId String @unique

  bio       String?
  skills    String[]
  avatarUrl String?
  interests String[]
  location  String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_profiles")
}

model UserSettings {
  id     String @id @default(uuid())
  userId String @unique

  notificationsEnabled Boolean @default(true)
  emailUpdates         Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Otp {
  id     String @id @default(uuid())
  userId String

  token String  @unique
  used  Boolean @default(false)

  createdAt DateTime @default(now())
  expiresAt DateTime

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("password_reset_tokens")
}

model Creator {
  id     String @id
  userId String @unique

  gigs             Gig[]
  organizationName String?
  rating           Float?  @default(0)
  totalGigsPosted  Int
  verified         Boolean

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("creators")
}

model Gig {
  id        String @id
  creatorId String @unique

  title       String
  description String
  category    String
  tags        String[]
  price       Float
  deadline    DateTime?
  status      GigStatus

  application Application[]
  contract    Contract?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  creator Creator @relation(fields: [creatorId], references: [id], onDelete: Cascade)

  @@map("gigs")
}

enum GigStatus {
  DRAFT
  ACTIVE
  COMPLETED
  CANCELLED
}

model Freelancer {
  id     String @id
  userId String @unique

  application Application[]
  skills      String[]
  bio         String?
  rating      Float?        @default(0)
  totalJobs   Int           @default(0)
  verified    Boolean       @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("freelancers")
}

model Application {
  id           String            @id
  gigId        String
  freelancerId String
  coverLetter  String
  status       ApplicationStatus
  createdAt    DateTime          @default(now())

  contract   Contract?
  gig        Gig        @relation(fields: [gigId], references: [id], onDelete: Cascade)
  freelancer Freelancer @relation(fields: [freelancerId], references: [id], onDelete: Cascade)
}

enum ApplicationStatus {
  PENDING
  ACCEPTED
  REJECTED
  WITHDRAWN
}

model Contract {
  id            String @id
  gigId         String @unique
  applicationId String @unique
  creatorId     String @unique
  freelancerId  String @unique

  startDate     DateTime
  endDate       DateTime?
  status        ContractStatus
  paymentStatus PaymentStatus

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  gig         Gig         @relation(fields: [gigId], references: [id], onDelete: Cascade)
  application Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@map("contracts")
}

enum ContractStatus {
  ACTIVE
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
}
